# pic-sure-hpds

PIC-SURE-HPDS was built from the ground up to support biomedical informatic use cases without requiring massive clustering as the datasets increase in scale. As such, PIC-SURE-HPDS can manage arbitrarily large datasets with very little computing.

For clinical data, datasets are stored as two files: metadata and data. The metadata file contains the internal data dictionary, high-level dataset-specific information, and file offsets for each variable's data within the data file. The data file contains data for three concepts: patient index, numerical index, and categorical index. 

This three-index layout in the data file enables numerical and categorical storage to be optimized and manipulated separately for different use-cases, circumventing complicated internal processing abstractions. For numerical variables, the Patient Index is stored in its optimized format, and the Numerical Index is generated by sorting the Patient Index by value for each use. Sorting even large arrays of fixed-width data in memory is extremely fast in modern JVM environments, so the processing effort to sort the data is similar to the effort required to read and decompress pre-sorted data. Both the Patient Index and Categorical Index are stored in their optimized format for categorical variables. The Patient Index for each variable type is optimized for generating data exports. The Numerical Index and Categorical Index are optimized for cohort filtering by variable values. When filtering patient cohorts by variable values, the Numerical Index or Categorical Index is used to obtain the list of patients who meet the filter criteria expressed in the query. The Patient Indices are optimized only for generating these filtered lists of patient identifiers with each query. 

For genomic data, variants that are not represented in the database are not stored. Genomic sample data is stored separately from variant annotations in HPDS. Variant annotations are stored using the same Numerical Index, and Categorical Index described above, indexing variant IDs instead of patient IDs. Each annotation variable is stored separately as two files due to the volume of annotation data. The first file is a dictionary index where each possible value for the annotation is mapped to the offset and length of the record in the second file, a storage file. Each record in the storage file is a list of integers identifying the variants annotated in the source VCF file with the annotation value. A String[] is stored on a disk and loaded into memory during system operation. This array contains a string representation of the specification of each variant in the system. The variant specification is of the form <chrom>,<offset>,<ref>,<alt>. The variant ID value corresponds to the offset in this array of the String representation of the variant. 
